name: "Check Submodule Changes"
description: "Checks for changes in submodule docs directories and sets the necessary output."

inputs:
  branch:
    description: "The branch to compare changes with"
    required: true
    default: "main"
  token:
    description: "PAT Token for checking out private submodules"
    required: true
  gh_token:
    description: "GitHub Token for action permission"
    required: true

outputs:
  docs_modified:
    description: "Indicates whether the docs in submodules were modified"
    value: ${{ steps.check_submodules.outputs.docs_modified }}

runs:
  using: "composite"
  steps:
    - name: "Checkout the repository"
      uses: actions/checkout@v3
      with:
        submodules: true
        token: ${{ inputs.token }}

    - name: "Ensure Script is Executable"
      run: |
        chmod +x ./scripts/check_if_docs_are_modified.sh
      working-directory: .github/actions/check-submodule-changes
      shell: bash

    - name: "Check for changes in submodule docs"
      id: check_submodules
      working-directory: .github/actions/check-submodule-changes
      shell: bash
      run: |
        ./scripts/check_if_docs_are_modified.sh ${{ inputs.branch }}
        echo "docs_modified=${{ env.docs_modified }}" >> $GITHUB_ENV
        echo "Successfully Executed !!"

    - name: "Apply label to PR if docs modified"
      if: ${{ steps.check_submodules.outputs.docs_modified == 'true' }}
      env:
        GH_TOKEN: ${{ inputs.gh_token }}
      uses: actions-ecosystem/action-add-labels@v1
      with:
        github_token: ${{ inputs.gh_token }}
        labels: application-docs
