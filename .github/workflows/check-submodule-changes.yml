name: "ü™ù Check for Submodule Changes"

on:
  push:
    branches:
      - main
  pull_request:
    branches:
      - main
  workflow_dispatch:

jobs:
  check_submodule_docs_changes:
    runs-on: ubuntu-latest
    outputs:
      description: "Indicates whether the docs in submodules were modified, comes from action flow"
      docs_modified: ${{ steps.set_downstream_variable.outputs.docs_modified }}

    steps:
      - name: Checkout the repository
        uses: actions/checkout@v4
        with:
          fetch-depth: 0
          submodules: recursive
          token: ${{ secrets.PAT_TOKEN }}

      - name: Check for changes in submodule docs
        id: check_submodule_changes
        uses: ./.github/actions/check-submodule-changes
        with:
          branch: 'main'
          token: ${{ secrets.PAT_TOKEN }}
          gh_token: ${{ secrets.GITHUB_TOKEN }}

      - name: Trigger Reusable Docs workflow
        id: trigger_application_docs
        if: ${{ steps.check_submodules.outputs.docs_modified == 'true' }}
        uses: .github/workflows/reusable/docs/deploy-application-docs.yml
        with:
          docs_modified: ${{ main_docs_modified }}
        env:
          main_docs_modified: ${{ steps.check_submodule_changes.outputs.docs_modified }}
