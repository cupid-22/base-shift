name: "ü™ù Check for Submodule Changes"

on:
  push:
    branches:
      - main
  pull_request:
    branches:
      - main
  workflow_dispatch:

jobs:
  base_check_submodule_changes:
    runs-on: ubuntu-latest
    outputs:
      docs_modified: ${{ steps.check_submodule_changes.outputs.docs_modified }}

    steps:
      - name: Checkout the repository
        uses: actions/checkout@v4
        with:
          fetch-depth: 0
          submodules: recursive
          token: ${{ secrets.PAT_TOKEN }}

      - name: Check for changes in submodule
        id: check_submodule_changes
        uses: ./.github/actions/check-submodule-changes
        with:
          branch: 'main'
          token: ${{ secrets.PAT_TOKEN }}
          gh_token: ${{ secrets.GITHUB_TOKEN }}

  application_docs:
    needs: base_check_submodule_changes
    if: needs.base_check_submodule_changes.outputs.docs_modified
    uses: ./.github/workflows/reusable-docs-deploy-application-docs.yml
    with:
      docs_modified: ${{ needs.base_check_submodule_changes.outputs.docs_modified }}
      branch: ${{ github.head_ref || 'main' }}
