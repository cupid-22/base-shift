name: "🪝 Check for Submodule Changes"

on:
  push:
    branches:
      - main
  pull_request:
    branches:
      - main
  workflow_dispatch:

jobs:
  base_check_submodule_changes:
    runs-on: ubuntu-latest
    outputs:
      description: "Indicates whether the docs in submodules were modified, comes from action flow"
      docs_modified: ${{ steps.check_submodule_changes.outputs.docs_modified }}

    steps:
      - name: Checkout the repository
        uses: actions/checkout@v4
        with:
          fetch-depth: 0
          submodules: recursive
          token: ${{ secrets.PAT_TOKEN }}

      - name: Check for changes in submodule docs
        id: check_submodule_changes
        uses: ./.github/actions/check-submodule-changes
        with:
          branch: 'main'
          token: ${{ secrets.PAT_TOKEN }}
          gh_token: ${{ secrets.GITHUB_TOKEN }}

      - name: Debug Outputs
        run: |
          echo "Docs modified output: $main_docs_modified"
          echo "Environment variable GITHUB_OUTPUT: ${GITHUB_OUTPUT:-not set}"
        env:
          main_docs_modified: ${{ steps.check_submodule_changes.outputs.docs_modified }}

      - name: Set output for downstream workflows
        run: |
          echo "docs_modified=$main_docs_modified" >> $GITHUB_OUTPUT
        env:
          main_docs_modified: ${{ steps.check_submodule_changes.outputs.docs_modified }}
